# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run. 
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'
  watch:
    type: [started]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    - name: ipv6
      run: ping6 aaa.meibu.com
    - name: ngrok
      run:  curl -o ngrok.zip https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip && unzip ngrok.zip && ./ngrok tcp --log stdout --region=ap --authtoken 4JVL23f2gyiwMVNwZGMst_6PQVhCv8gERuP5XGUXRwL 10086 &
    - name: run ui
      run: echo 'ewogICJpbmJvdW5kcyI6IFt7CiAgICAicG9ydCI6IDEwMDg2LAogICAgInByb3RvY29sIjogInZtZXNzIiwKICAgICJzZXR0aW5ncyI6IHsKICAgICAgImNsaWVudHMiOiBbeyAiaWQiOiAiYjgzMTM4MWQtNjMyNC00ZDUzLWFkNGYtOGNkYTQ4YjMwODExIiB9XQogICAgfQogIH1dLAogICJvdXRib3VuZHMiOiBbewogICAgInByb3RvY29sIjogImZyZWVkb20iLAogICAgInNldHRpbmdzIjoge30KICB9XQp9' > base64.config  && cat  base64.config | base64 -d > config.json && docker run --restart=always --name=v2ray -p10086:10086 -v $PWD/config.json:/etc/v2ray/config.json v2fly/v2fly-core
